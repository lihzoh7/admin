<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SPACE GLASS â€“ Admin Queries</title>

<style>
body {
  margin:0;
  font-family:Arial, sans-serif;
  background:#020b2d;
  color:white;
}

/* NAV TABS */
.admin-tabs {
  display:flex;
  gap:20px;
  padding:15px;
  background:#010821;
}

.admin-tabs div {
  cursor:pointer;
  padding:8px 16px;
  border-radius:6px;
}

.admin-tabs div.active,
.admin-tabs div:hover {
  background:#1b2a6b;
}

/* HEADER */
#header {
  padding:20px;
}

#count {
  margin-top:10px;
  color:#7FDBFF;
  font-weight:bold;
}

/* QUERY LIST */
#queries {
  padding:20px;
}

.query-card {
  background:rgba(255,255,255,0.06);
  padding:15px;
  border-radius:8px;
  margin-bottom:15px;
  border-left:4px solid #7FDBFF;
}

.query-meta {
  font-size:13px;
  color:#ddd;
  margin-bottom:8px;
}

.query-text {
  background:#000;
  padding:10px;
  border-radius:6px;
  white-space:pre-wrap;
  font-size:14px;
}
</style>
</head>

<body>

<!-- ADMIN NAV -->
<div class="admin-tabs">
  <div onclick="location.href='admin-messages.html'">Messages</div>
  <div onclick="location.href='admin-players.html'">Players</div>
  <div class="active">Queries</div>
  <div onclick="alert('Open admin-winners.html')">Winners</div>
  <div onclick="alert('Open admin-lives.html')">Lives</div>
</div>

<!-- HEADER -->
<div id="header">
  <h2>Player Queries</h2>
  <div id="count">Total Queries: 0</div>
</div>

<!-- QUERIES -->
<div id="queries"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBqJTLjxhZBCsvjrTH_cG0fkXlElG6BqTg",
  authDomain: "tose-ccf8f.firebaseapp.com",
  databaseURL: "https://tose-ccf8f-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "tose-ccf8f",
  storageBucket: "tose-ccf8f.firebasestorage.app",
  messagingSenderId: "475447495901",
  appId: "1:475447495901:web:9189276a162a3680afdf34"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const queriesDiv = document.getElementById("queries");
const countDiv = document.getElementById("count");

/* LOAD QUERIES (REALTIME) */
onValue(ref(db, "queries"), snap => {
  queriesDiv.innerHTML = "";
  const data = snap.val() || {};
  let count = 0;

  // Convert to array & sort newest first
  const arr = [];
  for(const key in data){
    arr.push(data[key]);
  }

  arr.sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0));

  arr.forEach(q => {
    count++;

    const date = q.timestamp
      ? new Date(q.timestamp).toLocaleString()
      : "N/A";

    const card = document.createElement("div");
    card.className = "query-card";

    card.innerHTML = `
      <div class="query-meta">
        <strong>${q.name || ""} ${q.surname || ""}</strong> |
        ID: ${q.idNumber || ""}<br>
        ${date}
      </div>
      <div class="query-text">${q.message || ""}</div>
    `;

    queriesDiv.appendChild(card);
  });

  countDiv.innerText = `Total Queries: ${count}`;
});
</script>

</body>
</html>
